[tox]
envlist = py311,py312,py313,flake8,pylint,ruff,format,security-safety,security-bandit
skip_missing_interpreters = true

[testenv]
commands_pre =
    python -m pip install -U pip
    python -m pip install poetry
    python -m poetry install --with dev
commands =
    python --version
    python -m pytest {posargs}
skipsdist = true

[testenv:flake8]
commands_pre =
    python -m pip install -U pip
    python -m pip install poetry
    python -m poetry install --with dev
commands = python -m flake8 app/ tests/
skipsdist = true

[testenv:pylint]
commands_pre =
    python -m pip install -U pip
    python -m pip install poetry
    python -m poetry install --with dev
commands = python -m pylint app/
skipsdist = true

[testenv:ruff]
commands_pre =
    python -m pip install -U pip
    python -m pip install poetry
    python -m poetry install --with dev
commands = python -m ruff check app/ tests/
skipsdist = true

[testenv:format]
commands_pre =
    python -m pip install -U pip
    python -m pip install poetry
    python -m poetry install --with dev
commands = python -m black --check app/ tests/
skipsdist = true

[testenv:format-fix]
commands_pre =
    python -m pip install -U pip
    python -m pip install poetry
    python -m poetry install --with dev
commands = python -m black app/ tests/
skipsdist = true

[testenv:security-bandit]
commands_pre =
    python -m pip install -U pip
    python -m pip install poetry
    python -m poetry install --with dev
commands =
    python -m bandit -r app/ -f json -o bandit-report.json
skipsdist = true

[testenv:security-safety]
commands_pre =
    python -m pip install -U pip
    python -m pip install poetry
    python -m poetry install --with dev
commands =
    python -m safety check --output text --save-json safety-report.json
skipsdist = true

[testenv:all]
commands_pre =
    python -m pip install -U pip
    python -m pip install poetry
    python -m poetry install --with dev
commands =
    python -m black --check app/ tests/
    python -m ruff check app/ tests/
    python -m flake8 app/ tests/
    python -m pylint app/
    python -m pytest {posargs}
skipsdist = true

[flake8]
max-line-length = 180
extend-ignore = E203, W503
exclude =
    .git,
    __pycache__,
    .venv,
    venv,
    build,
    dist,
    *.egg-info
per-file-ignores =
    __init__.py:F401
    tests/*:S101
